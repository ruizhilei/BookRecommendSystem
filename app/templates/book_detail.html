{% extends "base.html" %}
{% block title %}{{ book.title }} - 详情{% endblock %}
{% block content %}
  <div class="row">
    <div class="col-md-3">
      {% if book.image_url %}
      <img src="{{ book.image_url }}" alt="{{ book.title }}" class="img-fluid mb-3" />
      {% endif %}
    </div>
    <div class="col-md-9">
      <h2>{{ book.title }}</h2>

      {% if book.original_title and book.original_title != book.title %}
        <p class="text-muted">原始书名：{{ book.original_title }}</p>
      {% endif %}

      <p><strong>作者：</strong>{{ book.authors }}</p>
      <p><strong>语言：</strong>{{ book.language_code or '未知' }}</p>
      <p><strong>出版年份：</strong>{{ book.original_publication_year or '未知' }}</p>
      <p><strong>平均评分：</strong>{{ '%.2f'|format(book.average_rating or 0) }}</p>
      <p><strong>评分人数（Goodbooks 原始数据）：</strong>{{ book.ratings_count or 0 }}</p>

      {% if current_user.is_authenticated %}
        <hr />
        <h4>我的评分</h4>
        <form method="post" action="{{ url_for('main.rate_book', book_id=book.book_id) }}">
          <div class="mb-3">
            <label for="rating" class="form-label">请选择 1~5 分：</label>
            <select id="rating" name="rating" class="form-select" style="max-width: 200px;">
              {% for i in range(1, 6) %}
              <option value="{{ i }}"
                {% if user_rating and user_rating.rating == i %}selected{% endif %}>
                {{ i }} 分
              </option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">提交评分</button>
        </form>
      {% else %}
        <p class="mt-3 text-muted">登录后可以对本书进行评分。</p>
      {% endif %}

      <div class="mt-3">
        <a href="{{ url_for('main.books_list') }}" class="btn btn-secondary">返回列表</a>
      </div>
    </div>
  </div>
{% endblock %}

